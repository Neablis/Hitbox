!function(e,t){var r=t(),o="function"==typeof define,s="undefined"!=typeof module&&module.exports;if(o)define(r);else if(s)module.exports=r;else for(var n=t(),i=e.split("."),u=this.jQuery||this.ender||this.$||this,a=0;a<i.length;a++){var h=i[a];n&&a==i.length-1?n[h]=r:"undefined"==typeof u[h]&&(u[h]={}),u[h]=n}}("Hitbox",function(){"use strict";var e=[],t=function(e){this.home_router=void 0!==e?e.home_router||"http://api.hitbox.tv":"http://api.hitbox.tv"};return t.prototype.set=function(e){for(var t in e)this[t]=e[t];return this},t.prototype.get=function(e){return this[e]},t.prototype._parse_response=function(e,t){var r,o;try{o=e.status,r=e}catch(s){return t(null,e)}if(o>=300)return t(o,r.response);try{r=JSON.parse(r.response||r.responseText)}catch(s){}return t(null,r)},t.prototype._post_message=function(e,t,r){r=r||function(){},t=t||{};var o,s,n,i={},u=this;o=t.url;for(var a in e){var h=e[a];i[a]=h}if(!t.home_router)return r("Home router required");if(o=this._create_url({uri:o,query_params:t.query},{home_router:t.home_router}),s=JSON.stringify(i)+"\r\n",!this._is_server())return n="withCredentials"in new XMLHttpRequest?new XMLHttpRequest:new XDomainRequest,n.open("POST",o),n.timeout=this.timeout,n.onload=function(){t.raw?r(null,n):u._parse_response(n,r)},n.onerror=function(){try{console.log("error in _post_message "+JSON.parse(n.responseText))}catch(e){console.log("Unknown error in _post_message: "+e)}r(n)},n.onprogress=function(){},n.ontimeout=function(){try{console.log("error in _post_message "+JSON.parse(n.responseText))}catch(e){console.log("Unknown error in _post_message: "+e)}r(n)},"withCredentials"in new XMLHttpRequest&&n.setRequestHeader("Content-Type","text/plain"),n.send(s),n;var p,_,c;void 0===this.url_parser&&(this.url_parser=require("url")),void 0===this.https&&(this.https=require("https")),void 0===this.request&&(this.request=require("request")),p=this.url_parser.parse(o),_=p.path,c=p.host,this.request.post({url:o,body:s},function(e,t,o){e||200!=t.statusCode?r(t.statusCode,o):u._parse_response(o,r)})},t.prototype._get_message=function(e,t,r){t=t||{},r=r||function(){};var o,s=t.url,n=this;if(!t.home_router)return r("Home router required");if(s=this._create_url({uri:s,query_params:e},{home_router:t.home_router}),!this._is_server())return o="withCredentials"in new XMLHttpRequest?new XMLHttpRequest:new XDomainRequest,o.open("GET",s),o.timeout=this.timeout,o.onload=function(){t.raw?r(null,o):n._parse_response(o,r)},o.onerror=function(){try{console.log("error in _post_message "+JSON.parse(o.responseText))}catch(e){console.log("Unknown error in _post_message: "+e)}r(o)},o.onprogress=function(){},o.ontimeout=function(){try{console.log("error in _post_message "+JSON.parse(o.responseText))}catch(e){console.log("Unknown error in _post_message: "+e)}r(o)},o.send(null),o;void 0===this.url_parser&&(this.url_parser=require("url")),void 0===this.https&&(this.https=require("https")),void 0===this.request&&(this.request=require("request")),this.request(s,function(e,t,o){e||200!=t.statusCode?r(t.statusCode,o):n._parse_response(o,r)})},t.prototype._create_url=function(e,t){var r=e.query_params||{};t=t||{},t.home_router=t.home_router||this.home_router;var o="";t.home_router&&(o=-1===e.uri.indexOf("://")?void 0!==r.length?t.home_router+"/"+e.uri+"?":t.home_router+"/"+e.uri:void 0!==r.length?e.uri+"?":e.uri);for(var s in r)r[s]&&(o+="?"===o[o.length-1]?s+"="+encodeURIComponent(r[s].toString()):"&"+s+"="+encodeURIComponent(r[s].toString()));return o},t.prototype._is_server=function(){return!("undefined"!=typeof window&&window.document)},t.prototype.media=function(e,t,r){t=t||{};var o=t.router||this.home_router,s={},n="media/";return void 0!==e&&e.live&&(n+="live/"+e.live),this._get_message(s,{home_router:o,url:n},r)},t.prototype.user=function(e,t,r){t=t||{};var o=t.router||this.home_router,s={},n="user/";return void 0===e.user?r("User Required"):(n+=e.user,this._get_message(s,{home_router:o,url:n},r))},t.prototype.followers=function(e,t,r){t=t||{};var o=t.router||this.home_router,s={},n="followers/user/";return void 0===e.user?r("User Required"):(n+=e.user,void 0!==e.offset&&(s.offset=e.offset),void 0!==e.limit&&(s.limit=e.limit),this._get_message(s,{home_router:o,url:n},r))},t.prototype.games=function(e,t,r){t=t||{};var o=t.router||this.home_router,s={},n="games/";return this._get_message(s,{home_router:o,url:n},r)},t.prototype.teams=function(e,t,r){t=t||{};var o=t.router||this.home_router,s={},n="teams/";return void 0!==e.team&&(n+=e.team),this._get_message(s,{home_router:o,url:n},r)},t.prototype.chats=function(e,t,r){t=t||{};var o=t.router||this.home_router,s={},n="chat/servers";return this._get_message(s,{home_router:o,url:n},r)},t.prototype.servers=function(e,t,r){t=t||{};var o=t.router||this.home_router,s={},n="chat/servers.json";return this._get_message(s,{home_router:o,url:n},r)},t.prototype.chat_connect=function(e,t,r){t=t||{};var o=(t.router||this.home_router,this);this.chats(null,null,function(e,t){return e?r("Error getting chats list"):(o._get_websocket_url({chats:t},null,function(e,t){return e?r("Error getting websocket"):(o.chat_socket=new WebSocket(t),o.chat_socket.onmessage=o._on_message,void 0)}),void 0)})},t.prototype._on_message=function(t){e.forEach(function(e){e(t)})},t.prototype.add_listener=function(t){e.push(t)},t.prototype.send_message=function(e){return void 0===this.chat_socket?"no socket":(this.chat_socket.send(JSON.stringify(e)),void 0)},t.prototype._create_websocket_url=function(e){var t,r=!1,o=0,s="";return(void 0===e||void 0===e.chats||0===e.chats.length)&&callback("No chats provided"),t=e.chats,void 0!==e.random&&(r=e.random),r&&(o=Math.floor(Math.random()*(t.length-0))),s+=t[o].server_ip,s+="/socket.io/1/"},t.prototype._get_websocket_url=function(e,t,r){t=t||{};var o=t.router||this.home_router,s={},n="";if(void 0===e||void 0===e.chats||0===e.chats.length)return r("No chats provided");try{n=this._create_websocket_url({chats:JSON.parse(e.chats),random:!1})}catch(i){return r("error parsing chats list")}return this._get_message(s,{home_router:o,url:"http://"+n},function(e,t){return e?r("Error getting chats list"):(r(null,"ws://"+n+"websocket/"+t.split(":")[0]),void 0)})},t.prototype.token=function(e,t,r){t=t||{};var o=t.router||this.home_router,s={},n="auth/token";return void 0===e.login||void 0===e.pass?r("Missing params"):(s.login=e.login,s.pass=e.pass,s.app="desktop",this._post_message(s,{home_router:o,url:n},r))},t.prototype.ingesting=function(e,t,r){t=t||{};var o=t.router||this.home_router,s={},n="streamingest/";return void 0===e.username||void 0===e.token?r("Missing params"):(n+=e.username,s.token=e.token,this._get_message(s,{home_router:o,url:n},r))},t});