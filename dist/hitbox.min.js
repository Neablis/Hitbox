!function(e,r){"use strict";"undefined"!=typeof module?module.exports=r():"function"==typeof define&&"object"==typeof define.amd?define(r):this[e]=r()}("Hitbox",function(){"use strict";var e=function(e){e&&(this.home_router=e.home_router||void 0)};return e.prototype.set=function(e){for(var r in e)this[r]=e[r];return this},e.prototype._parse_response=function(e,r){var t,o;try{t=e.split("\r\n"),o=JSON.parse(t[0]),t=void 0!==o.code?t.splice(1,t.length-2):t.splice(0,t.length-1),1===t.length?t=JSON.parse(t[0]):Array.prototype.forEach.call(t,function(e,r){t[r]=JSON.parse(e)})}catch(s){return r(null,e)}return t.error||o.code>=300?r(t.error,t):r(null,t)},e.prototype._post_message=function(e,r,t){t=t||function(){},r=r||{};var o,s,n,i={},u=this;o=r.url;for(var a in e){var p=e[a];i[a]=p}if(!r.home_router)return t("Home router required");if(o=this._create_url({uri:o,query_params:r.query},{home_router:r.home_router}),s=JSON.stringify(i)+"\r\n",!this._is_server())return n="withCredentials"in new XMLHttpRequest?new XMLHttpRequest:new XDomainRequest,n.open("POST",o),n.timeout=5e3,n.onload=function(){var e;r.raw?(e=n.responseText.slice(n.responseText.indexOf("\r\n")+2,n.responseText.length),t(null,n)):u._parse_response(n.responseText,t)},n.onerror=function(){try{console.log("error in _post_message "+JSON.parse(n.responseText))}catch(e){console.log("Unknown error in _post_message: "+e)}t(n)},n.onprogress=function(){},n.ontimeout=function(){},"withCredentials"in new XMLHttpRequest&&n.setRequestHeader("Content-Type","text/plain"),n.send(s),n;var h,_,m;void 0===this.url_parser&&(this.url_parser=require("url")),void 0===this.https&&(this.https=require("https")),void 0===this.request&&(this.request=require("request")),h=this.url_parser.parse(o),_=h.path,m=h.host,this.request.post({url:o,body:s},function(e,r,o){e||200!=r.statusCode?t(r.statusCode,o):u._parse_response(o,t)})},e.prototype._get_message=function(e,r,t){r=r||{},t=t||function(){};var o,s=r.url,n=this;if(!r.home_router)return t("Home router required");if(s=this._create_url({uri:s,query_params:e},{home_router:r.home_router}),!this._is_server())return o="withCredentials"in new XMLHttpRequest?new XMLHttpRequest:new XDomainRequest,o.open("GET",s),o.timeout=5e3,o.onload=function(){var e;r.raw?(e=o.responseText.slice(o.responseText.indexOf("\r\n")+2,o.responseText.length),t(null,o)):n._parse_response(o.responseText,t)},o.onerror=function(){try{console.log("error in _post_message "+JSON.parse(o.responseText))}catch(e){console.log("Unknown error in _post_message: "+e)}t(o)},o.onprogress=function(){},o.ontimeout=function(){},o.send(null),o;void 0===this.url_parser&&(this.url_parser=require("url")),void 0===this.https&&(this.https=require("https")),void 0===this.request&&(this.request=require("request")),this.request(s,function(e,r,o){e||200!=r.statusCode?t(r.statusCode,o):n._parse_response(o,t)})},e.prototype._create_url=function(e,r){var t=e.query_params||{};r=r||{},r.home_router=r.home_router||this.home_router;var o="";r.home_router&&(o=-1===e.uri.indexOf("://")?r.home_router+"/"+e.uri+"?":e.uri+"?");for(var s in t)t[s]&&(o+="?"===o[o.length-1]?s+"="+encodeURIComponent(t[s].toString()):"&"+s+"="+encodeURIComponent(t[s].toString()));return o},e.prototype._is_server=function(){return!("undefined"!=typeof window&&window.document)},e.prototype.media=function(e,r,t){r=r||{};var o=r.router||this.home_router,s={},n="media/";return e.stream&&(n+=e.stream),this._get_message(s,{home_router:o,url:n,raw:!0},t)},e.prototype.user=function(e,r,t){r=r||{};var o=r.router||this.home_router,s={},n="user/";return void 0===e.user?t("User Required"):(n+=e.user,this._get_message(s,{home_router:o,url:n,raw:!0},t))},e.prototype.followers=function(e,r,t){r=r||{};var o=r.router||this.home_router,s={},n="followers/user/";return void 0===e.user?t("User Required"):(n+=e.user,void 0!==e.offset&&(s.offset=e.offset),void 0!==e.limit&&(s.limit=e.limit),this._get_message(s,{home_router:o,url:n,raw:!0},t))},e.prototype.games=function(e,r,t){r=r||{};var o=r.router||this.home_router,s={},n="games/";return this._get_message(s,{home_router:o,url:n,raw:!0},t)},e.prototype.games=function(e,r,t){r=r||{};var o=r.router||this.home_router,s={},n="teams/";return void 0!==e.team&&(n+=e.team),this._get_message(s,{home_router:o,url:n,raw:!0},t)},e.prototype.token=function(e,r,t){r=r||{};var o=r.router||this.home_router,s={},n="auth/token/";return void 0===e.login||void 0===e.pass?t("Missing params"):(s.login=e.login,s.pass=e.pass,s.app="desktop",this._post_message(s,{home_router:o,url:n,raw:!0},t))},e.prototype.ingesting=function(e,r,t){r=r||{};var o=r.router||this.home_router,s={},n="streamingest/";return void 0===e.username||void 0===e.token?t("Missing params"):(n+=e.username,s.token=e.token,this._get_message(s,{home_router:o,url:n,raw:!0},t))},e});